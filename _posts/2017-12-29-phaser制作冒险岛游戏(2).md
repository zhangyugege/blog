---
title: phaser制作冒险岛游戏(二）
teaser: phaser小手册--加载游戏资源
category: javascript
tags: [phaser]
---

![游戏截图](http://img.blog.csdn.net/20171229142843945?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvdTAxNDc4NzMwMQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast){:height="400px" width="700px"} 


-----


 目录:

<!-- vscode-markdown-toc -->
* 1. [1. 资源加载：Phaser.Loader](#1-资源加载：Phaser.Loader)
	* 1.1. [1.1. 加载图片](#11-加载图片)
	* 1.1. [1.2. 加载音频](#12-加载音频)
	* 1.3. [1.3 加载图片序列](#13-加载图片序列)
	* 1.4. [1.4 加载tile素材](#14-加载tile素材)
	* 1.5. [1.5 加载altas](#15-加载altas)
	* 1.6. [1.6 pack资源大杂烩](#16-pack资源大杂烩)
<!-- vscode-markdown-toc-config
	numbering=true
	autoSave=true
	/vscode-markdown-toc-config -->
<!-- /vscode-markdown-toc -->




## 1. 资源加载：Phaser.Loader

读取所有的外部资源文件（图片，视频，json文件，xml文件，txt文件）并且把他们添加到缓存对象中，在状态对象的预加载中自动调用

### 1.1 加载图片

```game.load.image('star', 'star.png');```

### 1.2 加载音频

```game.load.audio('bg', 'bg.mp3)');```

### 1.3. 加载图片序列

由于要指定帧的宽高，因此一般是动画的连续帧，例如行走动画的每一帧合成的图片。

```game.load.spritesheet(key, url, frameWidth, frameHeight, frameMax, margin, spacing)```

`key` : 给这张图片指定的名称，以后在创建sprite等对象时会要用到的

`url`: 图片的地址

`frameWidth` : 图片中每帧的宽度

`frameHeight` : 图片中每帧的高度

`frameMax` : 最多有几帧

`margin` : 每帧的外边距

`spacing` : 每帧之间的间隔

实例：

```
game.load.spritesheet(‘bird’,’assets/bird.png’,34,24,3); //鸟
```
### 1.4 加载tile素材

```new TileSprite(game, x, y, width, height, key, frame)```

`x`：tilesprite的x坐标

`y`：tilesprite的y坐标

`width`：tilesprite的宽度

`height`：tilesprite的高度

`key`：要使用sprite的key值

`frame`：tilesprite使用精灵的帧

TileSprite本质上还是一个sprite对象，不过这个sprite的贴图是可以移动的，并且会自动平铺来弥补移动后的空缺，所以我们的素材图片要是平铺后看不出有缝隙，就可以拿来当做TileSprite的移动贴图了。TileSprite的贴图既可以水平移动也可以垂直移动，或者两者同时移动，我们只需要调用TileSprite对象的autoScroll(x,y)方法就可以使它的贴图动起来了，其中x是水平方向的速度，y是垂直方向的速度。

### 1.5 加载altas

同样可以用作加载图片序列，但这种用法主要用于加载类似于TexturePacker打包出来的资源集合。相比于spritesheet一般是一连串的动画帧合成的图片，这种资源集合中的图片可以是各种各样的，和我们平常做网站会将icon、背景图片等合成sprites一个道理。
打包出来的资源一般包括一个json和一张合成的图片，json描述了合成图片中每张图片的宽高位置等信息。

```game.load.altasJSONArray('fly', 'fly.png', 'fly.json');```

### 1.6 pack资源大杂烩

添加一个资源包

```this.load.pack("level", "assets/assets-pack.json");```

一个pack的格式：
```
{
    "level": [
        {
            "type": "spritesheet",
            "key": "player",
            "url": "assets/images/fufu.png",
            "frameWidth": 207,
            "frameHeight": 140,
            "frameMax": -1,
            "margin": 0,
            "spacing": 0
        },
        {
            "type": "image",
            "key": "BG",
            "url": "assets/images/BG.png",
            "overwrite": false
        },
        {
            "type": "atlas",
            "key": "objects",
            "textureURL": "assets/textures/objects.png",
            "atlasURL": "assets/textures/objects.json",
            "format": "TEXTURE_ATLAS_JSON_HASH"
        },
        {
            "type": "atlas",
            "key": "tiles",
            "textureURL": "assets/textures/tiles.png",
            "atlasURL": "assets/textures/tiles.json",
            "format": "TEXTURE_ATLAS_JSON_HASH"
        },
        {
            "type": "script",
            "key": "scene1",
            "url": "assets/scenes/Scene1.js"
        }
    ],
    "meta": {
        "generated": "1474557782721",
        "app": "Phaser Editor",
    }
}
```
主要就是把所有资源写到一起，一块引用了。

在上述代码中有没有注意到一种特殊的资源：
```
{
  "type": "script",
  "key": "scene1",
  "url": "assets/scenes/Scene1.js"
}
```
这个就比较厉害了。直接把一个定义好的场景scene当作一个资源加载进来了。

让我们看看`ssets/scenes/Scene1.js`的源码

```
// Generated by Phaser Editor v1.2.1

/**
 * Scene1.
 * @param {Phaser.Game} aGame The game.
 * @param {Phaser.Group} aParent The parent group. If not given the game world will be used instead.
 */
function Scene1(aGame, aParent) {
	Phaser.Group.call(this, aGame, aParent);

	/* --- pre-init-begin --- */

	// you can insert code here

	/* --- pre-init-end --- */

	var BG = this.game.add.tileSprite(0, 0, 1713, 750, 'BG', null, this);
	BG.scale.setTo(1.1289946683730876, 1.0275188997398834);

	var Bush__2_ = this.game.add.tileSprite(114, 1466, 133, 65, 'objects', 'Bush (2)', this);
	Bush__2_.scale.setTo(1.2436090513997489, 1.4061541519275604);

	this.game.add.sprite(1125, 500, 'objects', 'Crate', this);

	this.game.add.sprite(1085, 1150, 'tiles', '1', this);

	this.game.add.tileSprite(1213, 1150, 512, 128, 'tiles', '2', this);

	var player = this.game.add.sprite(125, 1286, 'player', 0, this);
	player.anchor.setTo(0.5, 0.0);
	player.animations.add('jump', [2], 60, false);
	player.animations.add('idle', [3], 60, false);
	this.game.physics.arcade.enable(player);
	player.body.setSize(84.5, 91.66665649414062, 53.3333740234375, 43.333343505859375);
	player.body.collideWorldBounds = true;

	 // public fields

	this.fBG = BG;
	this.fPlayer = player;

	/* --- post-init-begin --- */

	// you can insert code here

	/* --- post-init-end --- */
}

/** @type Phaser.Group */
var Scene1_proto = Object.create(Phaser.Group.prototype);
Scene1.prototype = Scene1_proto;
Scene1.prototype.constructor = Phaser.Group;

/* --- end generated code --- */

// you can insert code here

```

这是一套phaser代码，主要定义了一个场景scene，在场景（这个场景不是第一节的那一圈生命周期，而是一幅画面的意思）里，把主人公，背景等摆放好位置。定义好动画等。还给他们起了别名，防止冲突。这套代码是phaser editor生成，不过这个软件是收费的，也可以自己写嘛～

未完待续



